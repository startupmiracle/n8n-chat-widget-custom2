// Startup Miracle â€“ Custom n8n Chat Widget Embed
(function () {
  const styles = `
    .sm-powered-by {
      display: block;
      text-align: center;
      font-size: 13px;
      padding: 8px;
      color: #666;
      font-family: sans-serif;
    }
    .sm-powered-by a {
      color: #854fff;
      text-decoration: none;
    }
  `;

  const styleSheet = document.createElement('style');
  styleSheet.textContent = styles;
  document.head.appendChild(styleSheet);

  const script = document.createElement('script');
  script.type = 'module';
  script.src = 'https://cdn.n8nchatui.com/v1/embed.js';

  script.onload = () => {
    import('https://cdn.n8nchatui.com/v1/embed.js').then(({ default: Chatbot }) => {
      Chatbot.init(window.ChatbotInitConfig || {});

      // Replace the footer if found
      const observer = new MutationObserver(() => {
        const root = document.querySelector('n8n-chat-widget');
        if (root && root.shadowRoot) {
          const footer = root.shadowRoot.querySelector('footer');
          if (footer && !footer.classList.contains('sm-customized')) {
            footer.innerHTML = '<div class="sm-powered-by">Powered by <a href="https://lp.startupmiracle.com" target="_blank">Startup Miracle</a></div>';
            footer.classList.add('sm-customized');
          }
        }
      });

      observer.observe(document.body, { childList: true, subtree: true });
    });
  };

  document.body.appendChild(script);
})();
